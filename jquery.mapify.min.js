(function(e,t,n,o){"use strict";var i="mapify";var a=i+"ResizeDone";var s={points:[],type:"roadmap",center:false,zoom:false,responsive:false,callback:false};var r={redraw:"drawMap",remove:"removeMap",destroy:"destroyMap"};var f=false;var p=function(t,n){this.element=t;this.settings=e.extend({},s,n);this._defaults=s;this._name=i;this.init()};p.googleLoaded=false;p.googleReady=function(){return typeof google!=="undefined"};p.until=function(e,t,n,o){if(e()){return t()}n=n||100;o=o||false;var i=setInterval(function(){if(e()){t();clearInterval(i)}},n);if(o){var a=setTimeout(function(){clearInterval(i)},o)}};p.getGoogleMaps=function(t){if(this.googleReady()){return t()}if(!this.googleLoaded){e.getScript("//maps.google.com/maps/api/js");this.googleLoaded=true}this.until(this.googleReady,t,50,4e3)};p.prototype.init=function(){this._style=e(this.element).attr("style");this.drawMap()};p.prototype.mapType=function(){var e=this.settings.type;var t=google.maps.MapTypeId;if(t.hasOwnProperty(e)){return t[e]}for(var n in t){if(t[n]===e){return e}}return t.ROADMAP};p.prototype.addPoint=function(t){var n=this;var o;var i;var a;if(!t.lat||!t.lng){return false}o=new google.maps.LatLng({lat:t.lat,lng:t.lng});n.bounds.extend(o);if(!t.marker){return}i=new google.maps.Marker({map:n.map,position:o});if(e.type(i)==="string"){i.setIcon(t.marker)}if(t.title){i.setTitle(t.title)}if(t.infoWindow){a=new google.maps.InfoWindow({content:t.infoWindow});i.addListener("click",function(){a.open(n.map,i)})}};p.prototype.resetBounds=function(){var e=this;var t=this.settings.center;var n=this.settings.zoom;e.map.fitBounds(e.bounds);if(t.lat&&t.lng){e.map.addListener("bounds_changed",function(){e.map.setCenter(t)})}if(n){e.map.addListener("bounds_changed",function(){if(e._zoomSet){return}e.map.setZoom(n);e._zoomSet=true})}};p.prototype.drawMap=function(){var n=this;n.map=new google.maps.Map(n.element,{mapTypeId:n.mapType()});n.bounds=new google.maps.LatLngBounds;e.each(n.settings.points,function(e,t){n.addPoint(t)});n.resetBounds();if(n.settings.responsive){e(t).on(a,function(){n._zoomSet=false;n.resetBounds()})}if(n.settings.callback){n.settings.callback(n.map,n.bounds,n.settings)}};p.prototype.removeMap=function(){e(this.element).empty().attr("style",this._style)};p.prototype.destroyMap=function(){this.removeMap();e.removeData(this.element,i)};e.fn[i]=function(t){var n=this;var o=[];if(t==="instance"){n.each(function(){o.push(e.data(this,i))});if(o.length===1){return o[0]}return o}p.getGoogleMaps(function(){n.each(function(){var n=e.data(this,i);if(e.type(t)==="string"){if(typeof n==="undefined"||typeof r[t]==="undefined"){return false}return n[r[t]]()}if(!e.data(this,i)){e.data(this,i,new p(this,t))}})});return n};e(t).on("resize",function(){clearTimeout(f);f=setTimeout(function(){e(t).trigger(a)},100)})})(jQuery,window,document);
